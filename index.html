<script>
  const playerState = {
    balance: 0,
  };

  const walletAddress = "UQAmyVyYj0GqYxYhINVXgzERiEe8Sa8c03mbV2Q8yYAMKvxg";

  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: "https://suomis7-netizen.github.io/fliptoncoin/tonconnect-manifest.json",
    buttonRootId: "ton-connect"
  });

  function updateBalanceDisplay() {
    document.getElementById('balance').textContent = `Your in-game balance: ${playerState.balance.toFixed(2)} TON`;
  }

  async function deposit() {
    try {
      const selectedAmount = document.getElementById('betAmount').value;
      const nanotons = (parseFloat(selectedAmount) * 1e9).toString();

      const tx = {
        validUntil: Math.floor(Date.now() / 1000) + 360,
        messages: [
          {
            address: walletAddress,
            amount: nanotons
          }
        ]
      };

      await tonConnectUI.sendTransaction(tx);
      playerState.balance += parseFloat(selectedAmount);
      updateBalanceDisplay();
      alert("Deposit successful!");
    } catch (e) {
      alert("‚ùå Deposit cancelled or failed.");
      console.error(e);
    }
  }

  function flip(userChoice) {
    const selectedAmount = parseFloat(document.getElementById('betAmount').value);

    if (playerState.balance < selectedAmount) {
      alert("Not enough balance. Please deposit more TON.");
      return;
    }

    const coin = document.getElementById('coin');
    const result = document.getElementById('result');
    coin.style.animation = 'flip 1s linear';

    setTimeout(() => {
      coin.style.animation = 'none';
      const outcome = Math.random() < 0.5 ? 'heads' : 'tails';
      coin.textContent = outcome === 'heads' ? 'H' : 'T';

      if (userChoice === outcome) {
        playerState.balance += selectedAmount;
        result.textContent = 'üéâ You WON!';
      } else {
        playerState.balance -= selectedAmount;
        result.textContent = 'üò¢ You LOST!';
      }
      updateBalanceDisplay();
    }, 1000);
  }

  updateBalanceDisplay();
</script>
